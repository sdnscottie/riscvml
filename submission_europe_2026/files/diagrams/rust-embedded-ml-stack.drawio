<mxfile host="app.diagrams.net" modified="2026-02-25T00:00:00.000Z" agent="draw.io" version="24.0.0" type="device">
  <diagram id="rust-stack" name="Rust Embedded ML Stack">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="850" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- Title -->
        <mxCell id="title" value="&lt;b&gt;Rust Safety in the Embedded ML Stack&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=18;fontColor=#1a1a1a;" vertex="1" parent="1">
          <mxGeometry x="280" y="20" width="380" height="40" as="geometry"/>
        </mxCell>

        <!-- Safety gradient labels -->
        <mxCell id="safety-high" value="&lt;font color=&quot;#2e7d32&quot; style=&quot;font-size:11px&quot;&gt;&lt;b&gt;FULL RUST&lt;br&gt;SAFETY&lt;/b&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="30" y="95" width="80" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="safety-arrow" value="" style="endArrow=block;endFill=1;strokeColor=#9e9e9e;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="70" y="145" as="sourcePoint"/>
            <mxPoint x="70" y="440" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="safety-low" value="&lt;font color=&quot;#b71c1c&quot; style=&quot;font-size:11px&quot;&gt;&lt;b&gt;HARDWARE&lt;br&gt;REGISTERS&lt;/b&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="25" y="445" width="90" height="40" as="geometry"/>
        </mxCell>

        <!-- Layer 1: Application Logic → main.rs -->
        <UserObject label="" link="https://github.com/sdnscottie/riscvml/blob/master/module6/bird-detection/src/main.rs" id="layer1">
          <mxCell style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8302B;strokeColor=#B71C1C;arcSize=8;shadow=1;" vertex="1" parent="1">
            <mxGeometry x="130" y="80" width="780" height="75" as="geometry"/>
          </mxCell>
        </UserObject>
        <mxCell id="layer1-title" value="&lt;b&gt;&lt;font color=&quot;#ffffff&quot; style=&quot;font-size:15px&quot;&gt;Application Logic&lt;/font&gt;&lt;/b&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="150" y="85" width="160" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="layer1-detail" value="&lt;font color=&quot;#ffebee&quot; style=&quot;font-size:11px&quot;&gt;Embassy async runtime &amp;nbsp;|&amp;nbsp; Bird detection state machine &amp;nbsp;|&amp;nbsp; Servo control &amp;nbsp;|&amp;nbsp; MQTT client&lt;br&gt;&lt;i&gt;100% safe Rust — borrow checker, ownership, lifetime guarantees&lt;/i&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="150" y="110" width="620" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="layer1-tag" value="&lt;b&gt;&lt;font color=&quot;#ffffff&quot; style=&quot;font-size:10px&quot;&gt;RUST&lt;/font&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#B71C1C;strokeColor=none;arcSize=30;" vertex="1" parent="1">
          <mxGeometry x="840" y="90" width="50" height="22" as="geometry"/>
        </mxCell>

        <!-- Layer 2: Rust HAL → hal.rs -->
        <UserObject label="" link="https://github.com/sdnscottie/riscvml/blob/master/module6/bird-detection/src/hal.rs" id="layer2">
          <mxCell style="rounded=1;whiteSpace=wrap;html=1;fillColor=#c62828;strokeColor=#b71c1c;arcSize=8;shadow=1;" vertex="1" parent="1">
            <mxGeometry x="130" y="175" width="780" height="75" as="geometry"/>
          </mxCell>
        </UserObject>
        <mxCell id="layer2-title" value="&lt;b&gt;&lt;font color=&quot;#ffffff&quot; style=&quot;font-size:15px&quot;&gt;Rust HAL Layer&lt;/font&gt;&lt;/b&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="150" y="180" width="150" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="layer2-detail" value="&lt;font color=&quot;#ffcdd2&quot; style=&quot;font-size:11px&quot;&gt;esp-hal (bare-metal) &amp;nbsp;|&amp;nbsp; esp-idf-hal (std) &amp;nbsp;|&amp;nbsp; Type-safe GPIO, SPI, I2C, UART &amp;nbsp;|&amp;nbsp; DMA abstractions&lt;br&gt;&lt;i&gt;Compile-time peripheral ownership — prevents data races on hardware&lt;/i&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="150" y="205" width="640" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="layer2-tag" value="&lt;b&gt;&lt;font color=&quot;#ffffff&quot; style=&quot;font-size:10px&quot;&gt;RUST&lt;/font&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#B71C1C;strokeColor=none;arcSize=30;" vertex="1" parent="1">
          <mxGeometry x="840" y="185" width="50" height="22" as="geometry"/>
        </mxCell>

        <!-- Layer 3: FFI Boundary → ffi.rs -->
        <UserObject label="" link="https://github.com/sdnscottie/riscvml/blob/master/module6/bird-detection/src/ffi.rs" id="ffi-boundary">
          <mxCell style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#E8302B;strokeWidth=3;dashed=1;dashPattern=8 4;" vertex="1" parent="1">
            <mxGeometry x="130" y="265" width="780" height="30" as="geometry"/>
          </mxCell>
        </UserObject>
        <mxCell id="ffi-label" value="&lt;b&gt;&lt;font color=&quot;#E8302B&quot; style=&quot;font-size:12px&quot;&gt;▸ FFI BOUNDARY ◂ &amp;nbsp;&amp;nbsp; Safe Rust wrappers around unsafe C calls&lt;/font&gt;&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="250" y="267" width="430" height="28" as="geometry"/>
        </mxCell>

        <!-- Layer 4: ESP-IDF C Drivers → camera.rs (FFI wrappers) -->
        <UserObject label="" link="https://github.com/sdnscottie/riscvml/blob/master/module6/bird-detection/src/camera.rs" id="layer4">
          <mxCell style="rounded=1;whiteSpace=wrap;html=1;fillColor=#424242;strokeColor=#212121;arcSize=8;shadow=1;" vertex="1" parent="1">
            <mxGeometry x="130" y="310" width="780" height="75" as="geometry"/>
          </mxCell>
        </UserObject>
        <mxCell id="layer4-title" value="&lt;b&gt;&lt;font color=&quot;#ffffff&quot; style=&quot;font-size:15px&quot;&gt;ESP-IDF C Drivers&lt;/font&gt;&lt;/b&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="150" y="315" width="170" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="layer4-detail" value="&lt;font color=&quot;#bdbdbd&quot; style=&quot;font-size:11px&quot;&gt;esp-video &amp;nbsp;|&amp;nbsp; esp-dl / esp-detection &amp;nbsp;|&amp;nbsp; Camera Controller &amp;nbsp;|&amp;nbsp; ISP &amp;nbsp;|&amp;nbsp; PPA &amp;nbsp;|&amp;nbsp; H.264 codec&lt;br&gt;&lt;i&gt;Mature Espressif C libraries — accessed through safe Rust FFI wrappers&lt;/i&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="150" y="340" width="620" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="layer4-tag" value="&lt;b&gt;&lt;font color=&quot;#ffffff&quot; style=&quot;font-size:10px&quot;&gt;C&lt;/font&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#616161;strokeColor=none;arcSize=30;" vertex="1" parent="1">
          <mxGeometry x="840" y="320" width="50" height="22" as="geometry"/>
        </mxCell>

        <!-- Layer 5: Hardware → Cargo.toml (target config) -->
        <UserObject label="" link="https://github.com/sdnscottie/riscvml/blob/master/module6/bird-detection/Cargo.toml" id="layer5">
          <mxCell style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1a1a1a;strokeColor=#424242;arcSize=8;shadow=1;" vertex="1" parent="1">
            <mxGeometry x="130" y="405" width="780" height="75" as="geometry"/>
          </mxCell>
        </UserObject>
        <mxCell id="layer5-title" value="&lt;b&gt;&lt;font color=&quot;#E8302B&quot; style=&quot;font-size:15px&quot;&gt;ESP32-P4 RISC-V Hardware&lt;/font&gt;&lt;/b&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="150" y="410" width="240" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="layer5-detail" value="&lt;font color=&quot;#9e9e9e&quot; style=&quot;font-size:11px&quot;&gt;Dual-core 400 MHz &amp;nbsp;|&amp;nbsp; 128-bit Vector ISA &amp;nbsp;|&amp;nbsp; AI Extensions &amp;nbsp;|&amp;nbsp; MIPI-CSI/DSI &amp;nbsp;|&amp;nbsp; PPA &amp;nbsp;|&amp;nbsp; DMA/2D-DMA&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="150" y="440" width="660" height="25" as="geometry"/>
        </mxCell>
        <mxCell id="layer5-tag" value="&lt;b&gt;&lt;font color=&quot;#ffffff&quot; style=&quot;font-size:10px&quot;&gt;HW&lt;/font&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#424242;strokeColor=none;arcSize=30;" vertex="1" parent="1">
          <mxGeometry x="840" y="415" width="50" height="22" as="geometry"/>
        </mxCell>

        <!-- Right side annotations -->
        <mxCell id="annotation-brace-top" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;flipH=1;size=0.5;strokeColor=#2e7d32;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="920" y="80" width="20" height="170" as="geometry"/>
        </mxCell>
        <mxCell id="annotation-safe" value="&lt;font color=&quot;#2e7d32&quot; style=&quot;font-size:11px&quot;&gt;&lt;b&gt;Memory-safe&lt;br&gt;No data races&lt;br&gt;No null ptrs&lt;br&gt;No use-after-free&lt;/b&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="945" y="125" width="110" height="70" as="geometry"/>
        </mxCell>

        <mxCell id="annotation-brace-bot" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;flipH=1;size=0.5;strokeColor=#e65100;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="920" y="310" width="20" height="75" as="geometry"/>
        </mxCell>
        <mxCell id="annotation-unsafe" value="&lt;font color=&quot;#e65100&quot; style=&quot;font-size:11px&quot;&gt;&lt;b&gt;Unsafe contained&lt;br&gt;behind safe API&lt;/b&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="945" y="320" width="120" height="45" as="geometry"/>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
